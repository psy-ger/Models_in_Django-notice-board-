{% extends 'base.html' %}
{% block content %}
<h1>Оголошення</h1>
<form method="get" class="mb-3">
    <input type="text" name="search" placeholder="Пошук по заголовку" value="{{ search }}">
    <select name="category">
        <option value="">Всі категорії</option>
        {% for cat in categories %}
            <option value="{{ cat.id }}" {% if cat.id|stringformat:'s' == selected_category %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
    </select>
    <input type="number" name="min_price" placeholder="Мін. ціна" value="{{ min_price }}" step="0.01">
    <input type="number" name="max_price" placeholder="Макс. ціна" value="{{ max_price }}" step="0.01">
    <select name="ordering">
        <option value="-created_at" {% if ordering == '-created_at' %}selected{% endif %}>Нові спочатку</option>
        <option value="created_at" {% if ordering == 'created_at' %}selected{% endif %}>Старі спочатку</option>
        <option value="price" {% if ordering == 'price' %}selected{% endif %}>Ціна ↑</option>
        <option value="-price" {% if ordering == '-price' %}selected{% endif %}>Ціна ↓</option>
    </select>
    <button type="submit">Фільтрувати</button>
</form>
<ul>
    {% for ad in ads %}
        <li>
            <a href="{% url 'ad_detail' ad.pk %}">{{ ad.title }}</a> — {{ ad.price }} грн, {{ ad.category.name }}<br>
            <small>{{ ad.created_at|date:'d.m.Y H:i' }}</small>
        </li>
    {% empty %}
        <li>Немає оголошень</li>
    {% endfor %}
</ul>
<div>
    {% if is_paginated %}
        <div>
            {% if page_obj.has_previous %}
                <a href="?{% if search %}search={{ search }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if ordering %}ordering={{ ordering }}&{% endif %}page={{ page_obj.previous_page_number }}">Попередня</a>
            {% endif %}
            <span>Сторінка {{ page_obj.number }} з {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a href="?{% if search %}search={{ search }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if ordering %}ordering={{ ordering }}&{% endif %}page={{ page_obj.next_page_number }}">Наступна</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
